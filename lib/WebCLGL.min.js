var WebCLGL=function(f){this.utils=new WebCLGLUtils();this._gl=null;this.e=undefined;if(f==undefined){this.e=document.createElement("canvas");this.e.width=32;this.e.height=32;this._gl=this.utils.getWebGLContextFromCanvas(this.e,{antialias:false})}else{this._gl=f}this._arrExt={OES_texture_float:null,OES_texture_float_linear:null,OES_element_index_uint:null,WEBGL_draw_buffers:null};for(var j in this._arrExt){this._arrExt[j]=this._gl.getExtension(j);if(this._arrExt[j]==null){console.error("extension "+j+" not available")}}this._maxDrawBuffers=null;if(this._arrExt.hasOwnProperty("WEBGL_draw_buffers")&&this._arrExt.WEBGL_draw_buffers!=null){this._maxDrawBuffers=this._gl.getParameter(this._arrExt.WEBGL_draw_buffers.MAX_DRAW_BUFFERS_WEBGL);console.log("Max draw buffers: "+this._maxDrawBuffers)}else{console.log("Max draw buffers: 1")}var h=this._gl.getShaderPrecisionFormat(this._gl.FRAGMENT_SHADER,this._gl.HIGH_FLOAT);this.precision=(h.precision!=0)?"precision highp float;\n\nprecision highp int;\n\n":"precision lowp float;\n\nprecision lowp int;\n\n";this._currentTextureUnit=0;this._bufferWidth=0;var k=this.utils.loadQuad(undefined,1,1);this.vertexBuffer_QUAD=this._gl.createBuffer();this._gl.bindBuffer(this._gl.ARRAY_BUFFER,this.vertexBuffer_QUAD);this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(k.vertexArray),this._gl.STATIC_DRAW);this.indexBuffer_QUAD=this._gl.createBuffer();this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,this.indexBuffer_QUAD);this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,new Uint16Array(k.indexArray),this._gl.STATIC_DRAW);this.arrayCopyTex=[];var i=this.precision+"attribute vec3 aVertexPosition;\nvarying vec2 vCoord;\nvoid main(void) {\ngl_Position = vec4(aVertexPosition, 1.0);\nvCoord = aVertexPosition.xy*0.5+0.5;\n}\n";var d=this.precision+"uniform sampler2D sampler_buffer;\nvarying vec2 vCoord;\nvoid main(void) {\ngl_FragColor = texture2D(sampler_buffer, vCoord);}\n";this.shader_readpixels=this._gl.createProgram();this.utils.createShader(this._gl,"CLGLREADPIXELS",i,d,this.shader_readpixels);this.attr_VertexPos=this._gl.getAttribLocation(this.shader_readpixels,"aVertexPosition");this.sampler_buffer=this._gl.getUniformLocation(this.shader_readpixels,"sampler_buffer");var b=(function(){return((this._maxDrawBuffers!=null)?"#extension GL_EXT_draw_buffers : require\n":"")}).bind(this);var e=(function(){var m="";for(var o=0,l=this._maxDrawBuffers;o<l;o++){m+="layout(location = "+o+") out vec4 outCol"+o+";\n"}return m}).bind(this);var a=(function(){var m="";for(var o=0,l=this._maxDrawBuffers;o<l;o++){m+="gl_FragData["+o+"] = texture2D(uArrayCT["+o+"], vCoord);\n"}return m}).bind(this);i=""+this.precision+"attribute vec3 aVertexPosition;\nvarying vec2 vCoord;\nvoid main(void) {\ngl_Position = vec4(aVertexPosition, 1.0);\nvCoord = aVertexPosition.xy*0.5+0.5;\n}";d=b()+this.precision+"uniform sampler2D uArrayCT["+this._maxDrawBuffers+"];\nvarying vec2 vCoord;\nvoid main(void) {\n"+a()+"}";this.shader_copyTexture=this._gl.createProgram();this.utils.createShader(this._gl,"CLGLCOPYTEXTURE",i,d,this.shader_copyTexture);this.attr_copyTexture_pos=this._gl.getAttribLocation(this.shader_copyTexture,"aVertexPosition");for(var c=0,g=this._maxDrawBuffers;c<g;c++){this.arrayCopyTex[c]=this._gl.getUniformLocation(this.shader_copyTexture,"uArrayCT["+c+"]")}this.textureDataAux=this._gl.createTexture();this._gl.bindTexture(this._gl.TEXTURE_2D,this.textureDataAux);this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,2,2,0,this._gl.RGBA,this._gl.FLOAT,new Float32Array([1,0,0,1,0,1,0,1,0,0,1,1,1,1,1,1]));this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.NEAREST);this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.NEAREST);this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE);this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE);this._gl.bindTexture(this._gl.TEXTURE_2D,null);this.getContext=function(){return this._gl};this.getMaxDrawBuffers=function(){return this._maxDrawBuffers};this.checkFramebufferStatus=function(){var m=this._gl.checkFramebufferStatus(this._gl.FRAMEBUFFER);var l={};l[this._gl.FRAMEBUFFER_COMPLETE]=true;l[this._gl.FRAMEBUFFER_INCOMPLETE_ATTACHMENT]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT: The attachment types are mismatched or not all framebuffer attachment points are framebuffer attachment complete";l[this._gl.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT: There is no attachment";l[this._gl.FRAMEBUFFER_INCOMPLETE_DIMENSIONS]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS: Height and width of the attachment are not the same";l[this._gl.FRAMEBUFFER_UNSUPPORTED]="FRAMEBUFFER_UNSUPPORTED: The format of the attachment is not supported or if depth and stencil attachments are not the same renderbuffer";if(l[m]!=true||l[m]==null){console.log(l[m]);return false}return true};this.copy=function(p,l){if(l!=null){if(l[0]!=null){this._gl.viewport(0,0,l[0].W,l[0].H);this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,l[0].fBuffer);var o=[];for(var q=0,m=l.length;q<m;q++){if(l[q]!=null){this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._arrExt.WEBGL_draw_buffers["COLOR_ATTACHMENT"+q+"_WEBGL"],this._gl.TEXTURE_2D,l[q].textureData,0);o[q]=this._arrExt.WEBGL_draw_buffers["COLOR_ATTACHMENT"+q+"_WEBGL"]}else{o[q]=this._gl.NONE}}this._arrExt.WEBGL_draw_buffers.drawBuffersWEBGL(o);if(this.checkFramebufferStatus()==true){this._gl.useProgram(this.shader_copyTexture);for(var q=0,m=l.length;q<m;q++){this._gl.activeTexture(this._gl["TEXTURE"+q]);if(l[q]!=null){this._gl.bindTexture(this._gl.TEXTURE_2D,l[q].textureDataTemp)}else{this._gl.bindTexture(this._gl.TEXTURE_2D,this.textureDataAux)}this._gl.uniform1i(this.arrayCopyTex[q],q)}this.copyNow(l)}}else{this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,null)}}else{this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,null)}};this.copyNow=function(l){this._gl.enableVertexAttribArray(this.attr_copyTexture_pos);this._gl.bindBuffer(this._gl.ARRAY_BUFFER,this.vertexBuffer_QUAD);this._gl.vertexAttribPointer(this.attr_copyTexture_pos,3,this._gl.FLOAT,false,0,0);this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,this.indexBuffer_QUAD);this._gl.drawElements(this._gl.TRIANGLES,6,this._gl.UNSIGNED_SHORT,0)};this.createBuffer=function(m,l,n){return new WebCLGLBuffer(this._gl,m,l,n)};this.createKernel=function(l,m){return new WebCLGLKernel(this._gl,l,m)};this.createVertexFragmentProgram=function(o,m,l,n){return new WebCLGLVertexFragmentProgram(this._gl,o,m,l,n)};this.fillBuffer=function(n,o,l){this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,l);this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._arrExt.WEBGL_draw_buffers["COLOR_ATTACHMENT0_WEBGL"],this._gl.TEXTURE_2D,n,0);var m=[this._arrExt.WEBGL_draw_buffers["COLOR_ATTACHMENT0_WEBGL"]];this._arrExt.WEBGL_draw_buffers.drawBuffersWEBGL(m);if(o!=undefined){this._gl.clearColor(o[0],o[1],o[2],o[3])}this._gl.clear(this._gl.COLOR_BUFFER_BIT)};this.bindAttributeValue=function(l,m){if(m!=null){if(l.type=="float4_fromAttr"){this._gl.enableVertexAttribArray(l.location[0]);this._gl.bindBuffer(this._gl.ARRAY_BUFFER,m.vertexData0);this._gl.vertexAttribPointer(l.location[0],4,this._gl.FLOAT,false,0,0)}else{if(l.type=="float_fromAttr"){this._gl.enableVertexAttribArray(l.location[0]);this._gl.bindBuffer(this._gl.ARRAY_BUFFER,m.vertexData0);this._gl.vertexAttribPointer(l.location[0],1,this._gl.FLOAT,false,0,0)}}}else{this._gl.disableVertexAttribArray(l.location[0])}};this.bindSamplerValue=function(m,l,n){if(this._currentTextureUnit<16){this._gl.activeTexture(this._gl["TEXTURE"+this._currentTextureUnit])}else{this._gl.activeTexture(this._gl.TEXTURE16)}if(n!=null){this._gl.bindTexture(this._gl.TEXTURE_2D,n.textureData);if(this._bufferWidth==0){this._bufferWidth=n.W;this._gl.uniform1f(m,this._bufferWidth)}}else{this._gl.bindTexture(this._gl.TEXTURE_2D,this.textureDataAux)}this._gl.uniform1i(l.location[0],this._currentTextureUnit);this._currentTextureUnit++};this.bindUniformValue=function(l,m){if(m!=null){if(l.type=="float"){this._gl.uniform1f(l.location[0],m)}else{if(l.type=="float4"){this._gl.uniform4f(l.location[0],m[0],m[1],m[2],m[3])}else{if(l.type=="mat4"){this._gl.uniformMatrix4fv(l.location[0],false,m)}}}}};this.bindValue=function(n,m,l){switch(m.expectedMode){case"ATTRIBUTE":this.bindAttributeValue(m,l);break;case"SAMPLER":this.bindSamplerValue(n.uBufferWidth,m,l);break;case"UNIFORM":this.bindUniformValue(m,l);break}};this.bindFB=function(l,m){if(l!=null){if(l[0]!=null){this._gl.viewport(0,0,l[0].W,l[0].H);this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,((m==true)?l[0].fBufferTemp:l[0].fBuffer));var q=[];for(var s=0,p=l.length;s<p;s++){if(l[s]!=null){var r=(m==true)?l[s].textureDataTemp:l[s].textureData;this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._arrExt.WEBGL_draw_buffers["COLOR_ATTACHMENT"+s+"_WEBGL"],this._gl.TEXTURE_2D,r,0);q[s]=this._arrExt.WEBGL_draw_buffers["COLOR_ATTACHMENT"+s+"_WEBGL"]}else{q[s]=this._gl.NONE}}this._arrExt.WEBGL_draw_buffers.drawBuffersWEBGL(q);return this.checkFramebufferStatus()}else{this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,null);return true}}else{this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,null);return true}};this.enqueueNDRangeKernel=function(m,o,l,p){this._bufferWidth=0;this._gl.useProgram(m.kernel);if(this.bindFB(o,l)==true){this._currentTextureUnit=0;for(var n in m.in_values){this.bindValue(m,m.in_values[n],p[n])}this._gl.enableVertexAttribArray(m.attr_VertexPos);this._gl.bindBuffer(this._gl.ARRAY_BUFFER,this.vertexBuffer_QUAD);this._gl.vertexAttribPointer(m.attr_VertexPos,3,this._gl.FLOAT,false,0,0);this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,this.indexBuffer_QUAD);this._gl.drawElements(this._gl.TRIANGLES,6,this._gl.UNSIGNED_SHORT,0)}};this.enqueueVertexFragmentProgram=function(l,o,r,p,m,q){this._bufferWidth=0;this._gl.useProgram(l.vertexFragmentProgram);var s=(r!=undefined)?r:4;if(this.bindFB(p,m)==true){if(o!=undefined){this._currentTextureUnit=0;for(var n in l.in_vertex_values){this.bindValue(l,l.in_vertex_values[n],q[n])}for(var n in l.in_fragment_values){this.bindValue(l,l.in_fragment_values[n],q[n])}if(o.mode=="VERTEX_INDEX"){this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,o.vertexData0);this._gl.drawElements(s,o.length,this._gl.UNSIGNED_SHORT,0)}else{this._gl.drawArrays(s,0,o.length)}}}};this.enqueueReadBuffer_WebGLTexture=function(l){return l.textureData};this.readBuffer=function(l){if(this.e!=undefined){this.e.width=l.W;this.e.height=l.H}this._gl.useProgram(this.shader_readpixels);this._gl.viewport(0,0,l.W,l.H);this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,l.fBufferTemp);this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._arrExt.WEBGL_draw_buffers["COLOR_ATTACHMENT0_WEBGL"],this._gl.TEXTURE_2D,l.textureDataTemp,0);var p=[this._arrExt.WEBGL_draw_buffers["COLOR_ATTACHMENT0_WEBGL"]];this._arrExt.WEBGL_draw_buffers.drawBuffersWEBGL(p);this._gl.activeTexture(this._gl.TEXTURE0);this._gl.bindTexture(this._gl.TEXTURE_2D,l.textureData);this._gl.uniform1i(this.sampler_buffer,0);this._gl.enableVertexAttribArray(this.attr_VertexPos);this._gl.bindBuffer(this._gl.ARRAY_BUFFER,this.vertexBuffer_QUAD);this._gl.vertexAttribPointer(this.attr_VertexPos,3,l._supportFormat,false,0,0);this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,this.indexBuffer_QUAD);this._gl.drawElements(this._gl.TRIANGLES,6,this._gl.UNSIGNED_SHORT,0);if(l.outArrayFloat==undefined){l.outArrayFloat=new Float32Array(l.W*l.H*4)}this._gl.readPixels(0,0,l.W,l.H,this._gl.RGBA,this._gl.FLOAT,l.outArrayFloat);if(l.type=="FLOAT"){var m=new Float32Array(l.outArrayFloat.length/4);for(var q=0,o=l.outArrayFloat.length/4;q<o;q++){m[q]=l.outArrayFloat[q*4]}l.outArrayFloat=m}return l.outArrayFloat}};var gpufor=function(){var b=new WebCLGLFor();var a=null;if(arguments[0] instanceof WebGLRenderingContext){a=arguments[0];b.setCtx(a);b._webCLGL=new WebCLGL(a);b.iniG(arguments);return b}else{if(arguments[0] instanceof HTMLCanvasElement){a=new WebCLGLUtils().getWebGLContextFromCanvas(arguments[0]);b.setCtx(a);b._webCLGL=new WebCLGL(a);b.iniG(arguments);return b}else{a=new WebCLGLUtils().getWebGLContextFromCanvas(document.createElement("canvas"),{antialias:false});b.setCtx(a);b._webCLGL=new WebCLGL(a);return b.ini(arguments)}}};var WebCLGLBuffer=function(d,b,a,c){this._gl=d;this.type=(b!=undefined)?b:"FLOAT";this._supportFormat=this._gl.FLOAT;this.linear=(a!=undefined)?a:true;this.mode=(c!=undefined)?c:"SAMPLER";this.W=null;this.H=null;this.textureData=null;this.textureDataTemp=null;this.vertexData0=null;this.fBuffer=null;this.renderBuffer=null;this.fBufferTemp=null;this.renderBufferTemp=null;this._oldW=0;if(this.mode=="SAMPLER"){this.textureData=this._gl.createTexture();this.textureDataTemp=this._gl.createTexture()}if(this.mode=="SAMPLER"||this.mode=="ATTRIBUTE"||this.mode=="VERTEX_INDEX"){this.vertexData0=this._gl.createBuffer()}this.createFramebufferAndRenderbuffer=function(){var e=(function(){var f=this._gl.createRenderbuffer();this._gl.bindRenderbuffer(this._gl.RENDERBUFFER,f);this._gl.renderbufferStorage(this._gl.RENDERBUFFER,this._gl.DEPTH_COMPONENT16,this.W,this.H);this._gl.bindRenderbuffer(this._gl.RENDERBUFFER,null);return f}).bind(this);if(this.fBuffer!=null){this._gl.deleteFramebuffer(this.fBuffer);this._gl.deleteFramebuffer(this.fBufferTemp);this._gl.deleteRenderbuffer(this.renderBuffer);this._gl.deleteRenderbuffer(this.renderBufferTemp)}this.fBuffer=this._gl.createFramebuffer();this.renderBuffer=e();this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,this.fBuffer);this._gl.framebufferRenderbuffer(this._gl.FRAMEBUFFER,this._gl.DEPTH_ATTACHMENT,this._gl.RENDERBUFFER,this.renderBuffer);this.fBufferTemp=this._gl.createFramebuffer();this.renderBufferTemp=e();this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,this.fBufferTemp);this._gl.framebufferRenderbuffer(this._gl.FRAMEBUFFER,this._gl.DEPTH_ATTACHMENT,this._gl.RENDERBUFFER,this.renderBufferTemp)};this.writeWebGLTextureBuffer=function(e,g){var i=(function(j,k){if(k==false||k==undefined){this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,false)}else{this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,true)}this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,false);this._gl.bindTexture(this._gl.TEXTURE_2D,j)}).bind(this);var f=(function(j){if(j instanceof HTMLImageElement){if(this.type=="FLOAT4"){this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._supportFormat,j)}}else{this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this.W,this.H,0,this._gl.RGBA,this._supportFormat,j)}}).bind(this);var h=(function(){this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.NEAREST);this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.NEAREST);this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE);this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE)}).bind(this);if(e instanceof WebGLTexture){this.textureData=e;this.textureDataTemp=e}else{i(this.textureData,g);f(e);h();i(this.textureDataTemp,g);f(e);h()}this._oldW=this.W;this._gl.bindTexture(this._gl.TEXTURE_2D,null)};this.writeBuffer=function(e,g,h){var f=(function(i){if(!(i instanceof HTMLImageElement)){if(this.length.constructor===Array){this.length=this.length[0]*this.length[1];this.W=this.length[0];this.H=this.length[1]}else{this.W=Math.ceil(Math.sqrt(this.length));this.H=this.W}if(this.type=="FLOAT4"){i=(i instanceof Float32Array)?i:new Float32Array(i);var j=(this.W*this.H*4);if(i.length!=j){var k=new Float32Array(j);for(var q=0;q<j;q++){k[q]=(i[q]!=null)?i[q]:0}i=k}}else{if(this.type=="FLOAT"){var j=(this.W*this.H*4);var o=new Float32Array(j);for(var q=0,m=this.W*this.H;q<m;q++){var p=q*4;o[p]=(i[q]!=null)?i[q]:0;o[p+1]=0;o[p+2]=0;o[p+3]=0}i=o}}}return i}).bind(this);if(h==undefined){if(e instanceof HTMLImageElement){this.length=(e.width*e.height)}else{this.length=((this.type=="FLOAT4")?e.length/4:e.length)}}else{this.length=[h[0],h[1]]}if(this.mode=="SAMPLER"){this.writeWebGLTextureBuffer(f(e),g)}if(this.mode=="SAMPLER"||this.mode=="ATTRIBUTE"){this._gl.bindBuffer(this._gl.ARRAY_BUFFER,this.vertexData0);this._gl.bufferData(this._gl.ARRAY_BUFFER,((e instanceof Float32Array)?e:new Float32Array(e)),this._gl.STATIC_DRAW)}if(this.mode=="VERTEX_INDEX"){this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,this.vertexData0);this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,new Uint16Array(e),this._gl.STATIC_DRAW)}this.createFramebufferAndRenderbuffer()};this.remove=function(){if(this.mode=="SAMPLER"){this._gl.deleteTexture(this.textureData);this._gl.deleteTexture(this.textureDataTemp)}if(this.mode=="SAMPLER"||this.mode=="ATTRIBUTE"||this.mode=="VERTEX_INDEX"){this._gl.deleteBuffer(this.vertexData0)}this._gl.deleteFramebuffer(this.fBuffer);this._gl.deleteFramebuffer(this.fBufferTemp);this._gl.deleteRenderbuffer(this.renderBuffer);this._gl.deleteRenderbuffer(this.renderBufferTemp)}};var WebCLGLFor=function(){this.kernels={};this.vertexFragmentPrograms={};this._args={};this._argsValues={};this.calledArgs={};this._webCLGL=null;this._gl=null;var a=(function(e,f){var g=function(m,j){var l=false;for(var k in j){if(k!="indices"){var i=k.split(" ");if(i.length>0){var n=i[1];if(n==m){l=true;break}}}}return l};var d=[];for(var h=0;h<e.length;h++){d[h]=(e[h]!=null)?g(e[h],f):false}return d}).bind(this);var c=(function(f,l){var k=[];var i=f.match(new RegExp(/return.*$/gm));i=i[0].replace("return ","");var j=i.match(new RegExp(/\[/gm));if(j!=null&&j.length>=1){i=i.split("[")[1].split("]")[0];var p="",m=0;for(var h=0;h<i.length;h++){if(i[h]==","&&m==0){k.push(p);p=""}else{p+=i[h]}if(i[h]=="("){m++}if(i[h]==")"){m--}}k.push(p)}else{k.push(i.replace(/;$/gm,""))}var e="";for(var h=0;h<l.length;h++){var q=false;for(var o in this._args){if(o!="indices"){var g=o.split(" ");if(g[1]==l[h]){var d=g[0].match(new RegExp("float4","gm"));e+=(d!=null&&d.length>0)?"out"+h+"_float4 = "+k[h]+";\n":"out"+h+"_float = "+k[h]+";\n";q=true;break}}}if(q==false){e+="out"+h+"_float4 = "+k[h]+";\n"}}return e}).bind(this);this.addKernel=function(m){var k=m.config;var n=k[0];var j=(k[1] instanceof Array)?k[1]:[k[1]];var l=k[2];var f=k[3];var h=this._webCLGL.createKernel();var g=[];for(var o in this._args){var e=o.split(" ");var d=e[1];var i=(l+f).match(new RegExp(d,"gm"));if(o!="indices"&&i!=null&&i.length>0){g.push(o.replace("*attr ","* "));h.in_values[d]={}}}f="void main("+g.toString()+") {vec2 "+n+" = get_global_id();"+f.replace(/return.*$/gm,c(f,j))+"}";h.name=m.name;h.viewSource=(m.viewSource!=null)?m.viewSource:false;h.setKernelSource(f,l);h.output=j;h.outputTempModes=a(j,this._args);h.enabled=true;h.drawMode=(m.drawMode!=null)?m.drawMode:4;h.depthTest=(m.depthTest!=null)?m.depthTest:true;h.blend=(m.blend!=null)?m.blend:false;h.blendEquation=(m.blendEquation!=null)?m.blendEquation:"FUNC_ADD";h.blendSrcMode=(m.blendSrcMode!=null)?m.blendSrcMode:"SRC_ALPHA";h.blendDstMode=(m.blendDstMode!=null)?m.blendDstMode:"ONE_MINUS_SRC_ALPHA";this.kernels[Object.keys(this.kernels).length.toString()]=h};this.addGraphic=function(f){var m=f.config;var l=[null];var n;var g;var p;var h;if(m.length==5){l=(m[0] instanceof Array)?m[0]:[m[0]];n=m[1];g=m[2];p=m[3];h=m[4]}else{n=m[0];g=m[1];p=m[2];h=m[3]}var i=this._webCLGL.createVertexFragmentProgram();var o=[],j=[];for(var q in this._args){var e=q.split(" ");var d=e[1];var k=(n+g).match(new RegExp(d,"gm"));if(q!="indices"&&k!=null&&k.length>0){o.push(q);i.in_vertex_values[d]={}}}for(var q in this._args){var e=q.split(" ");var d=e[1];var k=(p+h).match(new RegExp(d,"gm"));if(q!="indices"&&k!=null&&k.length>0){j.push(q);i.in_fragment_values[d]={}}}g="void main("+o.toString()+") {"+g+"}";h="void main("+j.toString()+") {"+h.replace(/return.*$/gm,c(h,l))+"}";i.name=f.name;i.viewSource=(f.viewSource!=null)?f.viewSource:false;i.setVertexSource(g,n);i.setFragmentSource(h,p);i.output=l;i.outputTempModes=a(l,this._args);i.enabled=true;i.drawMode=(f.drawMode!=null)?f.drawMode:4;i.depthTest=(f.depthTest!=null)?f.depthTest:true;i.blend=(f.blend!=null)?f.blend:true;i.blendEquation=(f.blendEquation!=null)?f.blendEquation:"FUNC_ADD";i.blendSrcMode=(f.blendSrcMode!=null)?f.blendSrcMode:"SRC_ALPHA";i.blendDstMode=(f.blendDstMode!=null)?f.blendDstMode:"ONE_MINUS_SRC_ALPHA";this.vertexFragmentPrograms[Object.keys(this.vertexFragmentPrograms).length.toString()]=i};var b=(function(e,k,f){var g=[];var i=false;var h=false;for(var l in k){for(var d in k[l].in_values){var j=k[l].in_values[d];if(d==e){g.push(k[l]);break}}}for(var l in f){for(var d in f[l].in_vertex_values){var j=f[l].in_vertex_values[d];if(d==e){i=true;break}}for(var d in f[l].in_fragment_values){var j=f[l].in_fragment_values[d];if(d==e){h=true;break}}}return{usedInVertex:i,usedInFragment:h,kernelPr:g}}).bind(this);this.fillArg=function(e,d){this._webCLGL.fillBuffer(this._argsValues[e].textureData,d,this._argsValues[e].fBuffer),this._webCLGL.fillBuffer(this._argsValues[e].textureDataTemp,d,this._argsValues[e].fBufferTemp)};this.getAllArgs=function(){return this._argsValues};this.addArg=function(d){this._args[d]=null};this.getGPUForArg=function(e,f){if(this.calledArgs.hasOwnProperty(e)==false){this.calledArgs[e]=[]}if(this.calledArgs[e].indexOf(f)==-1){this.calledArgs[e].push(f)}if(f.calledArgs.hasOwnProperty(e)==false){f.calledArgs[e]=[]}if(f.calledArgs[e].indexOf(this)==-1){f.calledArgs[e].push(this)}for(var d in f._args){var g=d.split(" ")[1];if(g==e){this._args[d]=f._args[d];this._argsValues[g]=f._argsValues[g];break}}};this.setArg=function(d,k,h,j){if(d=="indices"){this.setIndices(k)}else{for(var l in this._args){if(l.split(" ")[1]==d){var f=false;if(l.match(/\*/gm)!=null){var o=b(d,this.kernels,this.vertexFragmentPrograms);var g="SAMPLER";if(o.usedInVertex==true){if(o.kernelPr.length==0&&o.usedInFragment==false){g="ATTRIBUTE"}}var i=l.split("*")[0].toUpperCase();if(j!=undefined){i=j}if(k!=undefined&&k!=null){if(this._argsValues.hasOwnProperty(d)==false||(this._argsValues.hasOwnProperty(d)==true&&this._argsValues[d]==null)){this._argsValues[d]=this._webCLGL.createBuffer(i,false,g);this._argsValues[d].argument=d;f=true}this._argsValues[d].writeBuffer(k,false,h)}else{this._argsValues[d]=null}}else{if(k!=undefined&&k!=null){this._argsValues[d]=k}f=true}if(f==true&&this.calledArgs.hasOwnProperty(d)==true){for(var e=0;e<this.calledArgs[d].length;e++){var m=this.calledArgs[d][e];m._argsValues[d]=this._argsValues[d]}}break}}}return k};this.readArg=function(d){return this._webCLGL.readBuffer(this._argsValues[d])};this.setIndices=function(d){this.CLGL_bufferIndices=this._webCLGL.createBuffer("FLOAT",false,"VERTEX_INDEX");this.CLGL_bufferIndices.writeBuffer(d)};this.getCtx=function(){return this._webCLGL.getContext()};this.setCtx=function(d){this._gl=d};this.getWebCLGL=function(){return this._webCLGL};this.onPreProcessKernel=function(e,d){this.kernels[e].onpre=d};this.onPostProcessKernel=function(e,d){this.kernels[e].onpost=d};this.enableKernel=function(d){this.kernels[d.toString()|"0"].enabled=true};this.disableKernel=function(d){this.kernels[d.toString()|"0"].enabled=false};this.getKernel=function(d){for(var e in this.kernels){if(e==d){return this.kernels[e]}}return null};this.getAllKernels=function(){return this.kernels};this.onPreProcessGraphic=function(d,e){this.vertexFragmentPrograms[d].onpre=e};this.onPostProcessGraphic=function(d,e){this.vertexFragmentPrograms[d].onpost=e};this.enableGraphic=function(d){this.vertexFragmentPrograms[d.toString()|"0"].enabled=true};this.disableGraphic=function(d){this.vertexFragmentPrograms[d.toString()|"0"].enabled=false};this.getVertexFragmentProgram=function(d){for(var e in this.vertexFragmentPrograms){if(e==d){return this.vertexFragmentPrograms[e]}}return null};this.getAllVertexFragmentProgram=function(){return this.vertexFragmentPrograms};this.processKernels=function(f){var d=[];for(var g in this.kernels){var i=this.kernels[g];if(i.enabled==true){if(i.depthTest==true){this._gl.enable(this._gl.DEPTH_TEST)}else{this._gl.disable(this._gl.DEPTH_TEST)}if(i.blend==true){this._gl.enable(this._gl.BLEND)}else{this._gl.disable(this._gl.BLEND)}this._gl.blendFunc(this._gl[i.blendSrcMode],this._gl[i.blendDstMode]);this._gl.blendEquation(this._gl[i.blendEquation]);if(i.onpre!=undefined){i.onpre()}if(f==undefined||f==true){var e=false;for(var h=0;h<i.output.length;h++){if(i.output[h]!=null&&i.outputTempModes[h]==true){e=true;break}}if(e==true){this._webCLGL.enqueueNDRangeKernel(i,new WebCLGLUtils().getOutputBuffers(i,this._argsValues),true,this._argsValues);d.push(i)}else{this._webCLGL.enqueueNDRangeKernel(i,new WebCLGLUtils().getOutputBuffers(i,this._argsValues),false,this._argsValues)}}else{this._webCLGL.enqueueNDRangeKernel(i,new WebCLGLUtils().getOutputBuffers(i,this._argsValues),false,this._argsValues)}if(i.onpost!=undefined){i.onpost()}}}for(var h=0;h<d.length;h++){this._webCLGL.copy(d[h],new WebCLGLUtils().getOutputBuffers(d[h],this._argsValues))}};this.processGraphic=function(d){var e=[];for(var h in this.vertexFragmentPrograms){var g=this.vertexFragmentPrograms[h];if(g.enabled==true){var j=(d==undefined&&this.CLGL_bufferIndices!=undefined)?this.CLGL_bufferIndices:this._argsValues[d];if(j!=undefined&&j.length>0){if(g.depthTest==true){this._gl.enable(this._gl.DEPTH_TEST)}else{this._gl.disable(this._gl.DEPTH_TEST)}if(g.blend==true){this._gl.enable(this._gl.BLEND)}else{this._gl.disable(this._gl.BLEND)}this._gl.blendFunc(this._gl[g.blendSrcMode],this._gl[g.blendDstMode]);this._gl.blendEquation(this._gl[g.blendEquation]);if(g.onpre!=undefined){g.onpre()}var f=false;for(var i=0;i<g.output.length;i++){if(g.output[i]!=null&&g.outputTempModes[i]==true){f=true;break}}if(f==true){this._webCLGL.enqueueVertexFragmentProgram(g,j,g.drawMode,new WebCLGLUtils().getOutputBuffers(g,this._argsValues),true,this._argsValues);e.push(g)}else{this._webCLGL.enqueueVertexFragmentProgram(g,j,g.drawMode,new WebCLGLUtils().getOutputBuffers(g,this._argsValues),false,this._argsValues)}if(g.onpost!=undefined){g.onpost()}}}}for(var i=0;i<e.length;i++){this._webCLGL.copy(e[i],new WebCLGLUtils().getOutputBuffers(e[i],this._argsValues))}};this.ini=function(){var g=arguments[0];var e;var d;var i;if(g.length>3){this._args=g[0];e=g[1];d=g[2];i=g[3]}else{this._args=g[0];e=g[1];d="FLOAT";i=g[2]}var f=0;for(var h in this._args){var j=this._args[h];this.setArg(h.split(" ")[1],j);if(f==0&&(j instanceof Array||j instanceof Float32Array||j instanceof Uint8Array||j instanceof HTMLImageElement)){f=j.length}}if(d=="FLOAT"){this.addArg("float* result")}else{this.addArg("float4* result")}this.setArg("result",new Float32Array(f),null,d);this.addKernel({type:"KERNEL",name:"SIMPLE_KERNEL",viewSource:false,config:[e,["result"],"",i]});this.processKernels();return this._webCLGL.readBuffer(this._argsValues.result)};this.iniG=function(){this._webCLGL.getContext().depthFunc(this._webCLGL.getContext().LEQUAL);this._webCLGL.getContext().clearDepth(1);var d=arguments[0];this._args=d[1];for(var f=2;f<d.length;f++){if(d[f].type=="KERNEL"){this.addKernel(d[f])}else{if(d[f].type=="GRAPHIC"){this.addGraphic(d[f])}}}for(var e in this._args){var g=this._args[e];if(e=="indices"){if(g!=null){this.setIndices(g)}}else{this.setArg(e.split(" ")[1],g)}}}};var WebCLGLKernel=function(d,b,e){this._gl=d;var c=this._gl.getShaderPrecisionFormat(this._gl.FRAGMENT_SHADER,this._gl.HIGH_FLOAT);this._precision=(c.precision!=0)?"precision highp float;\n\nprecision highp int;\n\n":"precision lowp float;\n\nprecision lowp int;\n\n";var a=this._gl.getExtension("WEBGL_draw_buffers");this._maxDrawBuffers=null;if(a!=null){this._maxDrawBuffers=this._gl.getParameter(a.MAX_DRAW_BUFFERS_WEBGL)}this._utils=new WebCLGLUtils();this.name="";this.viewSource=false;this.in_values={};this.output=null;this.outputTempModes=null;this.fBuffer=null;this.fBufferTemp=null;this.fBufferLength=0;this.fBufferCount=0;if(b!=undefined){this.setKernelSource(b,e)}this.setKernelSource=function(k,o){var j=(function(){var n=""+this._precision+"attribute vec3 aVertexPosition;\nvarying vec2 global_id;\nvoid main(void) {\ngl_Position = vec4(aVertexPosition, 1.0);\nglobal_id = aVertexPosition.xy*0.5+0.5;\n}\n";var q="#extension GL_EXT_draw_buffers : require\n"+this._precision+this._utils.lines_fragment_attrs(this.in_values)+"varying vec2 global_id;\nuniform float uBufferWidth;vec2 get_global_id() {\nreturn global_id;\n}\n"+this._utils.get_global_id3_GLSLFunctionString()+this._utils.get_global_id2_GLSLFunctionString()+this._head+"void main(void) {\n"+this._utils.lines_drawBuffersInit(8)+this._source+this._utils.lines_drawBuffersWrite(8)+"}\n";this.kernel=this._gl.createProgram();var f=new WebCLGLUtils().createShader(this._gl,"WEBCLGL",n,q,this.kernel);this.attr_VertexPos=this._gl.getAttribLocation(this.kernel,"aVertexPosition");this.uBufferWidth=this._gl.getUniformLocation(this.kernel,"uBufferWidth");for(var p in this.in_values){var r={float4_fromSampler:"SAMPLER",float_fromSampler:"SAMPLER","float":"UNIFORM",float4:"UNIFORM",mat4:"UNIFORM"}[this.in_values[p].type];this._utils.checkArgNameInitialization(this.in_values,p);this.in_values[p].location=[this._gl.getUniformLocation(this.kernel,p)];this.in_values[p].expectedMode=r}return"VERTEX PROGRAM\n"+n+"\n FRAGMENT PROGRAM\n"+q}).bind(this);var g=k.split(")")[0].split("(")[1].split(",");for(var m=0,i=g.length;m<i;m++){if(g[m].match(/\*/gm)!=null){var l=g[m].split("*")[1].trim();this._utils.checkArgNameInitialization(this.in_values,l);if(g[m].match(/float4/gm)!=null){this.in_values[l].type="float4_fromSampler"}else{if(g[m].match(/float/gm)!=null){this.in_values[l].type="float_fromSampler"}}}else{if(g[m]!=""){var l=g[m].split(" ")[1].trim();this._utils.checkArgNameInitialization(this.in_values,l);if(g[m].match(/float4/gm)!=null){this.in_values[l].type="float4"}else{if(g[m].match(/float/gm)!=null){this.in_values[l].type="float"}else{if(g[m].match(/mat4/gm)!=null){this.in_values[l].type="mat4"}}}}}}this._head=(o!=undefined)?o:"";this._head=this._head.replace(/\r\n/gi,"").replace(/\r/gi,"").replace(/\n/gi,"");this._head=this._utils.parseSource(this._head,this.in_values);this._source=k.replace(/\r\n/gi,"").replace(/\r/gi,"").replace(/\n/gi,"");this._source=this._source.replace(/^\w* \w*\([\w\s\*,]*\) {/gi,"").replace(/}(\s|\t)*$/gi,"");this._source=this._utils.parseSource(this._source,this.in_values);var h=j();if(this.viewSource==true){console.log("%c KERNEL: "+this.name,"font-size: 20px; color: blue"),console.log("%c WEBCLGL --------------------------------","color: gray"),console.log("%c "+o+k,"color: gray"),console.log("%c TRANSLATED WEBGL ------------------------------","color: darkgray"),console.log("%c "+h,"color: darkgray")}}};var WebCLGLUtils=function(){this.loadQuad=function(e,d,a){var b=(d==undefined)?0.5:d;var c=(a==undefined)?0.5:a;this.vertexArray=[-b,-c,0,b,-c,0,b,c,0,-b,c,0];this.textureArray=[0,0,0,1,0,0,1,1,0,0,1,0];this.indexArray=[0,1,2,0,2,3];var f={};f.vertexArray=this.vertexArray;f.textureArray=this.textureArray;f.indexArray=this.indexArray;return f};this.getWebGLContextFromCanvas=function(a,c){var d;if(d==null){try{if(c==undefined){d=a.getContext("webgl")}else{d=a.getContext("webgl",c)}console.log((d==null)?"no webgl":"using webgl")}catch(b){d=null}}if(d==null){try{if(c==undefined){d=a.getContext("experimental-webgl")}else{d=a.getContext("experimental-webgl",c)}console.log((d==null)?"no experimental-webgl":"using experimental-webgl")}catch(b){d=null}}if(d==null){d=false}return d};this.createShader=function(h,b,l,g,a){var i=false,e=false;var j=(function(s,w){console.log(s);var q=[];var y=s.split("\n");for(var r=0,v=y.length;r<v;r++){if(y[r].match(/^ERROR/gim)!=null){var o=y[r].split(":");var A=parseInt(o[2]);q.push([A,y[r]])}}var t=h.getShaderSource(w).split("\n");t.unshift("");for(var r=0,v=t.length;r<v;r++){var u=false;var z="";for(var x=0,p=q.length;x<p;x++){if(r==q[x][0]){u=true;z=q[x][1];break}}if(u==false){console.log("%c"+r+" %c"+t[r],"color:black","color:blue")}else{console.log("%c►►%c"+r+" %c"+t[r]+"\n%c"+z,"color:red","color:black","color:blue","color:red")}}}).bind(this);var d=h.createShader(h.VERTEX_SHADER);h.shaderSource(d,l);h.compileShader(d);if(!h.getShaderParameter(d,h.COMPILE_STATUS)){var c=h.getShaderInfoLog(d);console.log("%c"+b+" ERROR (vertex program)","color:red");if(c!=undefined){j(c,d)}}else{h.attachShader(a,d);i=true}var k=h.createShader(h.FRAGMENT_SHADER);h.shaderSource(k,g);h.compileShader(k);if(!h.getShaderParameter(k,h.COMPILE_STATUS)){var c=h.getShaderInfoLog(k);console.log("%c"+b+" ERROR (fragment program)","color:red");if(c!=undefined){j(c,k)}}else{h.attachShader(a,k);e=true}if(i==true&&e==true){h.linkProgram(a);var m=h.getProgramParameter(a,h.LINK_STATUS);if(m){return true}else{console.log("Error shader program "+b+":\n ");var f=h.getProgramInfoLog(a);if(f!=undefined){console.log(f)}return false}}else{return false}};this.getUint8ArrayFromHTMLImageElement=function(d){var c=document.createElement("canvas");c.width=d.width;c.height=d.height;var b=c.getContext("2d");b.drawImage(d,0,0);var a=b.getImageData(0,0,d.width,d.height);return a.data};this.dot4=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]};this.fract=function(a){return a-Math.floor(a)};this.pack=function(h){var f=[1/255,1/255,1/255,0];var j=h;var i=this.fract(j*255);var d=this.fract(i*255);var e=this.fract(d*255);var k=[j,i,d,e];var c=[k[1]*f[0],k[2]*f[1],k[3]*f[2],k[3]*f[3]];return[k[0]-c[0],k[1]-c[1],k[2]-c[2],k[3]-c[3]]};this.unpack=function(b){var a=[1,1/255,1/(255*255),1/(255*255*255)];return this.dot4(b,a)};this.packGLSLFunctionString=function(){return"vec4 pack (float depth) {\nconst vec4 bias = vec4(1.0 / 255.0,\n1.0 / 255.0,\n1.0 / 255.0,\n0.0);\nfloat r = depth;\nfloat g = fract(r * 255.0);\nfloat b = fract(g * 255.0);\nfloat a = fract(b * 255.0);\nvec4 colour = vec4(r, g, b, a);\nreturn colour - (colour.yzww * bias);\n}\n"};this.unpackGLSLFunctionString=function(){return"float unpack (vec4 colour) {\nconst vec4 bitShifts = vec4(1.0,\n1.0 / 255.0,\n1.0 / (255.0 * 255.0),\n1.0 / (255.0 * 255.0 * 255.0));\nreturn dot(colour, bitShifts);\n}\n"};this.getOutputBuffers=function(c,a){var b=null;if(c.output!=undefined){b=[];if(c.output[0]!=null){for(var d=0;d<c.output.length;d++){b[d]=a[c.output[d]]}}else{b=null}}return b};this.parseSource=function(a,l){for(var k in l){var h=new RegExp(k+"\\[.*?\\]","gm");var e=a.match(h);if(e!=null){for(var j=0,i=e.length;j<i;j++){var g=new RegExp("```(s|\t)*gl.*"+e[j]+".*```[^```(s|\t)*gl]","gm");var f=a.match(g);if(f==null){var d=e[j].split("[")[0];var c=e[j].split("[")[1].split("]")[0];var b={float4_fromSampler:a.replace(d+"["+c+"]","texture2D("+d+","+c+")"),float_fromSampler:a.replace(d+"["+c+"]","texture2D("+d+","+c+").x"),float4_fromAttr:a.replace(d+"["+c+"]",d),float_fromAttr:a.replace(d+"["+c+"]",d)};a=b[l[k].type]}}}}a=a.replace(/```(\s|\t)*gl/gi,"").replace(/```/gi,"").replace(/;/gi,";\n").replace(/}/gi,"}\n").replace(/{/gi,"{\n");return a};this.lines_vertex_attrs=function(a){var c="";for(var b in a){c+={float4_fromSampler:"uniform sampler2D "+b+";",float_fromSampler:"uniform sampler2D "+b+";",float4_fromAttr:"attribute vec4 "+b+";",float_fromAttr:"attribute float "+b+";","float":"uniform float "+b+";",float4:"uniform vec4 "+b+";",mat4:"uniform mat4 "+b+";"}[a[b].type]+"\n"}return c};this.lines_fragment_attrs=function(a){var c="";for(var b in a){c+={float4_fromSampler:"uniform sampler2D "+b+";",float_fromSampler:"uniform sampler2D "+b+";","float":"uniform float "+b+";",float4:"uniform vec4 "+b+";",mat4:"uniform mat4 "+b+";"}[a[b].type]+"\n"}return c};this.lines_drawBuffersInit=function(a){var c="";for(var d=0,b=a;d<b;d++){c+="float out"+d+"_float = -999.99989;\nvec4 out"+d+"_float4;\n"}return c};this.lines_drawBuffersWriteInit=function(a){var c="";for(var d=0,b=a;d<b;d++){c+="layout(location = "+d+") out vec4 outCol"+d+";\n"}return c};this.lines_drawBuffersWrite=function(a){var c="";for(var d=0,b=a;d<b;d++){c+="if(out"+d+"_float != -999.99989) gl_FragData["+d+"] = vec4(out"+d+"_float,0.0,0.0,1.0);\n else gl_FragData["+d+"] = out"+d+"_float4;\n"}return c};this.checkArgNameInitialization=function(a,b){if(a.hasOwnProperty(b)==false){a[b]={type:null,expectedMode:null,location:null}}};this.get_global_id3_GLSLFunctionString=function(){return"vec2 get_global_id(float id, float bufferWidth, float geometryLength) {\nfloat num = (id*geometryLength)/bufferWidth;float column = fract(num)*bufferWidth;float row = floor(num);float ts = 1.0/(bufferWidth-1.0);return vec2(column*ts, row*ts);}\n"};this.get_global_id2_GLSLFunctionString=function(){return"vec2 get_global_id(vec2 id, float bufferWidth) {\nfloat column = id.x;float row = id.y;float ts = 1.0/(bufferWidth-1.0);return vec2(column*ts, row*ts);}\n"}};var WebCLGLVertexFragmentProgram=function(f,g,c,b,d){this._gl=f;var e=this._gl.getShaderPrecisionFormat(this._gl.FRAGMENT_SHADER,this._gl.HIGH_FLOAT);this._precision=(e.precision!=0)?"precision highp float;\n\nprecision highp int;\n\n":"precision lowp float;\n\nprecision lowp int;\n\n";var a=this._gl.getExtension("WEBGL_draw_buffers");this._maxDrawBuffers=null;if(a!=null){this._maxDrawBuffers=this._gl.getParameter(a.MAX_DRAW_BUFFERS_WEBGL)}this._utils=new WebCLGLUtils();this.name="";this.viewSource=false;this.in_vertex_values={};this.in_fragment_values={};this._vertexP_ready=false;this._fragmentP_ready=false;this._vertexHead=null;this._vertexSource=null;this._fragmentHead=null;this._fragmentSource=null;this.output=null;this.outputTempModes=null;this.fBuffer=null;this.fBufferTemp=null;this.drawMode=4;if(g!=undefined){this.setVertexSource(g,c)}if(b!=undefined){this.setFragmentSource(b,d)}this.compileVertexFragmentSource=function(){var i=""+this._precision+"uniform float uOffset;\nuniform float uBufferWidth;"+this._utils.lines_vertex_attrs(this.in_vertex_values)+this._utils.unpackGLSLFunctionString()+this._utils.get_global_id3_GLSLFunctionString()+this._utils.get_global_id2_GLSLFunctionString()+this._vertexHead+"void main(void) {\n"+this._vertexSource+"}\n";var k="#extension GL_EXT_draw_buffers : require\n"+this._precision+this._utils.lines_fragment_attrs(this.in_fragment_values)+this._fragmentHead+"void main(void) {\n"+this._utils.lines_drawBuffersInit(8)+this._fragmentSource+this._utils.lines_drawBuffersWrite(8)+"}\n";this.vertexFragmentProgram=this._gl.createProgram();var h=this._utils.createShader(this._gl,"WEBCLGL VERTEX FRAGMENT PROGRAM",i,k,this.vertexFragmentProgram);this.uOffset=this._gl.getUniformLocation(this.vertexFragmentProgram,"uOffset");this.uBufferWidth=this._gl.getUniformLocation(this.vertexFragmentProgram,"uBufferWidth");for(var j in this.in_vertex_values){var l={float4_fromSampler:"SAMPLER",float_fromSampler:"SAMPLER",float4_fromAttr:"ATTRIBUTE",float_fromAttr:"ATTRIBUTE","float":"UNIFORM",float4:"UNIFORM",mat4:"UNIFORM"}[this.in_vertex_values[j].type];this._utils.checkArgNameInitialization(this.in_vertex_values,j);var m=(l=="ATTRIBUTE")?this._gl.getAttribLocation(this.vertexFragmentProgram,j):this._gl.getUniformLocation(this.vertexFragmentProgram,j);this.in_vertex_values[j].location=[m];this.in_vertex_values[j].expectedMode=l}for(var j in this.in_fragment_values){var l={float4_fromSampler:"SAMPLER",float_fromSampler:"SAMPLER","float":"UNIFORM",float4:"UNIFORM",mat4:"UNIFORM"}[this.in_fragment_values[j].type];this._utils.checkArgNameInitialization(this.in_fragment_values,j);this.in_fragment_values[j].location=[this._gl.getUniformLocation(this.vertexFragmentProgram,j)];this.in_fragment_values[j].expectedMode=l}return"VERTEX PROGRAM\n"+i+"\n FRAGMENT PROGRAM\n"+k};this.setVertexSource=function(o,i){var h=o.split(")")[0].split("(")[1].split(",");for(var m=0,k=h.length;m<k;m++){if(h[m].match(/\*attr/gm)!=null){var l=h[m].split("*attr")[1].trim();this._utils.checkArgNameInitialization(this.in_vertex_values,l);if(h[m].match(/float4/gm)!=null){this.in_vertex_values[l].type="float4_fromAttr"}else{if(h[m].match(/float/gm)!=null){this.in_vertex_values[l].type="float_fromAttr"}}}else{if(h[m].match(/\*/gm)!=null){var l=h[m].split("*")[1].trim();this._utils.checkArgNameInitialization(this.in_vertex_values,l);if(h[m].match(/float4/gm)!=null){this.in_vertex_values[l].type="float4_fromSampler"}else{if(h[m].match(/float/gm)!=null){this.in_vertex_values[l].type="float_fromSampler"}}}else{if(h[m]!=""){var l=h[m].split(" ")[1].trim();this._utils.checkArgNameInitialization(this.in_vertex_values,l);if(h[m].match(/float4/gm)!=null){this.in_vertex_values[l].type="float4"}else{if(h[m].match(/float/gm)!=null){this.in_vertex_values[l].type="float"}else{if(h[m].match(/mat4/gm)!=null){this.in_vertex_values[l].type="mat4"}}}}}}}this._vertexHead=(i!=undefined)?i:"";this._vertexHead=this._vertexHead.replace(/\r\n/gi,"").replace(/\r/gi,"").replace(/\n/gi,"");this._vertexHead=this._utils.parseSource(this._vertexHead,this.in_vertex_values);this._vertexSource=o.replace(/\r\n/gi,"").replace(/\r/gi,"").replace(/\n/gi,"");this._vertexSource=this._vertexSource.replace(/^\w* \w*\([\w\s\*,]*\) {/gi,"").replace(/}(\s|\t)*$/gi,"");this._vertexSource=this._utils.parseSource(this._vertexSource,this.in_vertex_values);this._vertexP_ready=true;if(this._fragmentP_ready==true){var j=this.compileVertexFragmentSource();if(this.viewSource==true){console.log("%c VFP: "+this.name,"font-size: 20px; color: green"),console.log("%c WEBCLGL --------------------------------","color: gray"),console.log("%c "+i+o,"color: gray"),console.log("%c TRANSLATED WEBGL ------------------------------","color: darkgray"),console.log("%c "+j,"color: darkgray")}}};this.setFragmentSource=function(i,j){var h=i.split(")")[0].split("(")[1].split(",");for(var o=0,l=h.length;o<l;o++){if(h[o].match(/\*/gm)!=null){var m=h[o].split("*")[1].trim();this._utils.checkArgNameInitialization(this.in_fragment_values,m);if(h[o].match(/float4/gm)!=null){this.in_fragment_values[m].type="float4_fromSampler"}else{if(h[o].match(/float/gm)!=null){this.in_fragment_values[m].type="float_fromSampler"}}}else{if(h[o]!=""){var m=h[o].split(" ")[1].trim();this._utils.checkArgNameInitialization(this.in_fragment_values,m);if(h[o].match(/float4/gm)!=null){this.in_fragment_values[m].type="float4"}else{if(h[o].match(/float/gm)!=null){this.in_fragment_values[m].type="float"}else{if(h[o].match(/mat4/gm)!=null){this.in_fragment_values[m].type="mat4"}}}}}}this._fragmentHead=(j!=undefined)?j:"";this._fragmentHead=this._fragmentHead.replace(/\r\n/gi,"").replace(/\r/gi,"").replace(/\n/gi,"");this._fragmentHead=this._utils.parseSource(this._fragmentHead,this.in_fragment_values);this._fragmentSource=i.replace(/\r\n/gi,"").replace(/\r/gi,"").replace(/\n/gi,"");this._fragmentSource=this._fragmentSource.replace(/^\w* \w*\([\w\s\*,]*\) {/gi,"").replace(/}(\s|\t)*$/gi,"");this._fragmentSource=this._utils.parseSource(this._fragmentSource,this.in_fragment_values);this._fragmentP_ready=true;if(this._vertexP_ready==true){var k=this.compileVertexFragmentSource();if(this.viewSource==true){console.log("%c VFP: ","font-size: 20px; color: green"),console.log("%c WEBCLGL --------------------------------","color: gray"),console.log("%c "+j+i,"color: gray"),console.log("%c TRANSLATED WEBGL ------------------------------","color: darkgray"),console.log("%c "+k,"color: darkgray")}}}};