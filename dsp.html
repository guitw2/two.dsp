
<html>
<meta charset="UTF-8">
<head>
<style>
	body {
		font-family: "lucida grande","Segoe UI",Arial, sans-serif; 
		background-color: #323232;
		//background-image: url("./body-bg.png");
		font-size: 14px;
		padding:0;
		margin:0;
	}
	.divider{
		margin: 1.5em;
		width: 100%;
		display:inline-block;
	}	
	#container0{
		display: table;
		margin: auto;
	}
	#container1{
		position: relative;
		margin: 3.2em 1em 1em 1em;
		padding: 1em;
		//border-radius: 2em;
		background-color: #424242;
		max-width: 860px;
	}
	#container2{
		display: none;
		position: relative;
		margin: 3.2em 1em 1em 1em;
		padding: 1em;
		//border-radius: 2em;
		background-color: #424242;
		max-width: 860px;
	}
	#logo{
		display: inline-block;
		border-right: 0.5em solid #323232; 
		width: 5em;
	}
	#audio_file{
		background-color: inherit;
		border: 1px solid #aaa; 
		padding: 0.2em;
		width: 23em;
	}
	#load_file{
		height: 2em;
	}
	#getCoeficients{
		height: 2em;
	}
	#textCoeficients{
		background-color: #aaa;
		outline: 0;
	}
	#menu{
		font-size: 0.75em;
		display: inline-block;
		color: #424242;
	}
	.menuElement{
		background-color: #232323;
		border-right: 0.1em solid #323232; 
		display: inline-block;
		padding: 0 1em;
		line-height:2em;
	}
	.menuElement:hover{
		cursor: pointer;
		background-color: #292929;
	}
	.menuSelected{
		color: #709070;
	}
	header{
		font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; 
		font-size:2.2em; 
		background-color: #232323; 
		color: #fff; 
		padding-left: 1em;
		position: fixed;
		width: 100%; 
		height: 1.6em; 
		line-height:1.6em;
		display: inline-block;
	}	
	footer{
		margin: 0 1em;
		color: #aaa;
		position:absolute;
		bottom:0;
	}	
	a{
		color: bbbbcc;
	}
	p{
		color: #aaa;
	}
	.label_text{
		color: #aaa;
		margin: 0;
	}
	button{
		background-color: #ccc;
		color: #424242;
		outline: 0;
		border: none;
	}
	.play_button{
		width: 25em;
		height: 10em;
		margin: 2em;
	}	
	.play_button[disabled]{
		background-color: #525252;
	}	
	.stop_button{
		width: 25em;
		height: 10em;
		margin: 2em;
		color: #aa4242;
	}	
	.stop_button[disabled]{
		background-color: #525252;
		color: #424242;
	}	
	#vol-control{
		margin: 1em;
	}
	input[type=file]{
		decoration: none;
		border: 1px;
		border-color: #aaa;
		background-color: #FFFFFF;
		color: #aaa;
		outline: 0;
		position: relative;
		padding: auto;
	}
	.modal {
		display: none;
		position: absolute;
		z-index: 1;
		left: 0;
		top: 0;
		width: 100%;
		height:100%;
		overflow: auto;
		background-color: #232323;
	}
	.modal-content {
		color: #424242;
		background-color: #ccc;
		margin: 15% auto;
		padding: 1em;
		align: center;
	}	
	.switch {
		position: relative;
		display: inline-block;
		width: 60px;
		height: 34px;
	}
	.switch input {display:none;}
	.slider {
		position: absolute;
		cursor: pointer;
		top: 0;
		left: 0;
		right: 0;
		bottom: 0;
		background-color: #707070;
	}
	.slider:before {
		position: absolute;
		content: "";
		height: 26px;
		width: 26px;
		left: 4px;
		bottom: 4px;
		background-color: #ddd;
	}
	input:checked + .slider {
		background-color: #709070;
	}
	input:focus + .slider {
		box-shadow: 0 0 1px #3bc375;
	}
	input:checked + .slider:before {
		-webkit-transform: translateX(26px);
		-ms-transform: translateX(26px);
		transform: translateX(26px);
	}	
</style>
<script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
<script>	
	$(document).ready(function(){
		var source=null;
		var file_array=null;
		var impulse_array=null;
		var visual_type='t';
		var modal = document.getElementById('myModal');
		var decodingModal = document.getElementById('decodingModal');
		var loaded=false;
		var impulse_loaded=false;
		var audioCtx = new(AudioContext || webkitAudioContext);
		var source = audioCtx.createBufferSource();
		var convolver = audioCtx.createConvolver();
		var processorBufferSize=2048;//16384
		var scriptNode = audioCtx.createScriptProcessor(processorBufferSize);
		var bufferSecundario = [new Float32Array(processorBufferSize),new Float32Array(processorBufferSize)];
		var inputData = new Float32Array(processorBufferSize);
		var audioBuffer= null;
		var masterGain = audioCtx.createGain();
		var analyser = audioCtx.createAnalyser();
		analyser.fftSize = 2048;
		var bufferLength = analyser.frequencyBinCount;
		var dataArray = new Uint8Array(bufferLength);
		var textCoeficients = document.getElementById("textCoeficients");
		analyser.getByteTimeDomainData(dataArray);
		masterGain.gain.value=0.3;

		var canvasWave = document.getElementById("oscilloscope");
		var canvasImpulse = document.getElementById("graphImpulse");
		var container1 = document.getElementById("container1");
		var container2 = document.getElementById("container1");
		var canvasCtxWave = canvasWave.getContext("2d");
		var canvasCtxImpulse = canvasImpulse.getContext("2d");
		
		function resize_canvas(){
			canvasWave.width  = container1.clientWidth*.97;
			canvasWave.height = 100;
			canvasImpulse.width  = container1.clientWidth*.97;
			canvasImpulse.height = 100;
		}
		
		 $(window).on('resize', function() {
			resize_canvas();
		});
		
		function draw() {			
			drawVisual = requestAnimationFrame(draw);
			if(visual_type=='t'){
				analyser.getByteTimeDomainData(dataArray);
				canvasCtxWave.fillStyle = '#424242';
				canvasCtxWave.fillRect(0, 0, canvasWave.width, canvasWave.height);
				canvasCtxWave.lineWidth = 1;
				canvasCtxWave.strokeStyle = '#aaa';
				canvasCtxWave.beginPath();
				var sliceWidth = canvasWave.width * 1.0 / bufferLength;
				var x = 0;
				for (var i = 0; i < bufferLength; i++) {
					var v = dataArray[i] / 128.0;
					var y = v * canvasWave.height / 2;
					if (i === 0) {
						canvasCtxWave.moveTo(x, y);
					} else {
						canvasCtxWave.lineTo(x, y);
					}
					x += sliceWidth;
				}
				canvasCtxWave.stroke();
			}
			else{
				analyser.getByteFrequencyData(dataArray);
				canvasCtxWave.fillStyle = '#424242';
				canvasCtxWave.fillRect(0, 0, canvasWave.width, canvasWave.height);
				canvasCtxWave.lineWidth = 1;
				canvasCtxWave.strokeStyle = '#aaa';
				canvasCtxWave.beginPath();
				var sliceWidth = canvasWave.width * 1.0 / bufferLength;
				var x = 0;
				for(var i = 0; i < bufferLength; i++) {
	   				var v = dataArray[i] / 128.0;
					var y = canvasWave.height - v * canvasWave.height/2 -1;
					if(i === 0) {
						canvasCtxWave.moveTo(x, y);
					} else {
						canvasCtxWave.lineTo(x, y);
					}
					x += sliceWidth;
				}
				canvasCtxWave.stroke();
			}			
		};
		
		resize_canvas();
		draw();		
		
		scriptNode.onaudioprocess = function(audioProcessingEvent) {	
			var inputBuffer = audioProcessingEvent.inputBuffer;
			var outputBuffer = audioProcessingEvent.outputBuffer;
			
			for (var channel = 0; channel < outputBuffer.numberOfChannels; channel++) {
				var inputData = inputBuffer.getChannelData(channel);
				var outputData = outputBuffer.getChannelData(channel);

				for (var sample = 0; sample < processorBufferSize; sample++){
					processando=0;
					for(var index=0; index < coeficients.length; index++){
						if(sample+index<coeficients.length){
							processando += bufferSecundario[channel][(sample+index)+(processorBufferSize-coeficients.length)]*coeficients[index];				
						}
						else{
							processando += inputData[(sample+index)-coeficients.length]*coeficients[index];				
						}
					}
					//console.log(sample+index);
					outputData[sample]=processando;		
				}
				bufferSecundario[channel]=inputData;
			}			
		}		
		
		var coeficients = new Float32Array([-7.60387794584338e-07,-2.59659837711268e-07,-3.33606248345541e-07,-4.17834408805857e-07,-5.12154147228806e-07,-6.16072875535055e-07,-7.28759296617454e-07,-8.49009809686771e-07,-9.75218694001071e-07,-1.10535319377551e-06,-1.23693465076478e-06,-1.36702683353428e-06,-1.49223259171050e-06,-1.60869991772379e-06,-1.71213842626197e-06,-1.79784716176526e-06,-1.86075451617924e-06,-1.89547088270588e-06,-1.89635448684709e-06,-1.85759062458968e-06,-1.77328430070119e-06,-1.63756599997700e-06,-1.44471004371163e-06,-1.18926468609567e-06,-8.66192794710010e-07,-4.71021640426103e-07,4.45313678728079e-21,5.49739544871617e-07,1.18001553919068e-06,1.89143254004421e-06,2.68321895295421e-06,3.55307106198484e-06,4.49700670648745e-06,5.50923222512636e-06,6.58202640663524e-06,7.70564525030232e-06,8.86825134164361e-06,1.00558715848695e-05,1.12523868991003e-05,1.24395572762396e-05,1.35970853123658e-05,1.47027209599881e-05,1.57324098052809e-05,1.66604866535602e-05,1.74599156102765e-05,1.81025771776432e-05,1.85596021541489e-05,1.88017513326073e-05,1.87998391505708e-05,1.85251985648479e-05,1.79501835109037e-05,1.70487043808010e-05,1.57967910239781e-05,1.41731768585356e-05,1.21598967926915e-05,9.74289081321988e-06,6.91260431704773e-06,3.66457556098216e-06,-2.89719267377562e-20,-4.07373920647937e-06,-8.54258560212579e-06,-1.33853800528926e-05,-1.85734989325399e-05,-2.40705711141284e-05,-2.98322847095129e-05,-3.58062940100488e-05,-4.19322363954913e-05,-4.81418680908409e-05,-5.43593265620017e-05,-6.05015260529610e-05,-6.64786912854027e-05,-7.21950326752301e-05,-7.75495645818067e-05,-8.24370661107082e-05,-8.67491818587006e-05,-9.03756577431642e-05,-9.32057047231078e-05,-9.51294808241022e-05,-9.60396794565135e-05,-9.58332095993489e-05,-9.44129510469669e-05,-9.16895656205954e-05,-8.75833430699886e-05,-8.20260583722624e-05,-7.49628153146993e-05,-6.63538496653903e-05,-5.61762639281772e-05,-4.44256646829561e-05,-3.11176728631918e-05,-1.62892770505984e-05,1.05993133452081e-19,1.76671508312944e-05,3.66049769670717e-05,5.66816535579416e-05,7.77405898025864e-05,9.96006075534227e-05,0.000122056457647812,0.000144879690187308,0.000167819891237305,0.000190606294264461,0.000212949770103344,0.000234545194387696,0.000255074186243570,0.000274208206675691,0.000291611999545419,0.000306947352404964,0.000319877148789184,0.000330069677949087,0.000337203162518870,0.000340970459322546,0.000341083883529787,0.000337280101746987,0.000329325035461345,0.000317018712623681,0.000300200002137491,0.000278751163690595,0.000252602143789614,0.000221734548097256,0.000186185220281444,0.000146049358607650,0.000101483103475706,5.27055320431335e-05,-2.72230054807109e-19,-5.62852245353016e-05,-0.000115737084158355,-0.000177878654706590,-0.000242170901809923,-0.000308015297547260,-0.000374757313962308,-0.000441690800169006,-0.000508063239154665,-0.000573081869274513,-0.000635920643942718,-0.000695727991290332,-0.000751635323717093,-0.000802766235456336,-0.000848246314650926,-0.000887213485158078,-0.000918828782519326,-0.000942287458406476,-0.000956830298541192,-0.000961755030737496,-0.000956427692479417,-0.000940293821459319,-0.000912889327894821,-0.000873850904330451,-0.000822925827117309,-0.000759981003936869,-0.000685011123663319,-0.000598145768592739,-0.000499655354637275,-0.000389955772496302,-0.000269611612060710,-0.000139337863343584,5.37177083728209e-19,0.000147387634083492,0.000301665198690712,0.000461532537861143,0.000625556194723728,0.000792178268432394,0.000959727100451988,0.00112642975615688,0.00129042624596151,0.00144978540824230,0.00160252235438350,0.00174661735464425,0.00188003602246388,0.00200075063456296,0.00210676240502364,0.00219612451370543,0.00226696567312352,0.00231751400352989,0.00234612097361916,0.00235128515424334,0.00233167552495189,0.00228615406824375,0.00221379738426638,0.00211391705943763,0.00198607852618044,0.00183011815769880,0.00164615835150292,0.00143462036819149,0.00119623470776780,0.000932048824412150,0.000643432002029988,0.000332077236883820,-8.52450501358639e-19,-0.000350466219407064,-0.000716677657790323,-0.00109569134461979,-0.00148427949604933,-0.00187894720335777,-0.00227595334963682,-0.00267133465296501,-0.00306093269920638,-0.00344042379299497,-0.00380535142180244,-0.00415116109562817,-0.00447323729418294,-0.00476694222483189,-0.00502765606838063,-0.00525081836636615,-0.00543197018316895,-0.00556679665927958,-0.00565116955868737,-0.00568118940383001,-0.00565322678603127,-0.00556396243799917,-0.00541042565785376,-0.00519003068135335,-0.00490061061049201,-0.00454044852240617,-0.00410830540246133,-0.00360344456935039,-0.00302565228783724,-0.00237525429619009,-0.00165312801009286,-0.000860710202584408,1.11525091376610e-18,0.000926442923411805,0.00191550502496741,0.00296353047392486,0.00406633761264831,0.00521924023107068,0.00641707353961575,0.00765422467891608,0.00892466755886528,0.0102220017752608,0.0115394953100107,0.0128701306810565,0.0142066541712504,0.0155416277318285,0.0168674831262285,0.0181765778541581,0.0194612523743253,0.0207138881273672,0.0219269658484580,0.0230931236520136,0.0242052143689365,0.0252563616200281,0.0262400141175205,0.0271499977001030,0.0279805646252207,0.0287264396656406,0.0293828625850936,0.0299456265999464,0.0304111124700099,0.0307763179013986,0.0310388819874128,0.0311971044592847,0.0312499595668516,0.0311971044592847,0.0310388819874128,0.0307763179013986,0.0304111124700099,0.0299456265999464,0.0293828625850936,0.0287264396656406,0.0279805646252207,0.0271499977001030,0.0262400141175205,0.0252563616200281,0.0242052143689365,0.0230931236520136,0.0219269658484580,0.0207138881273672,0.0194612523743253,0.0181765778541581,0.0168674831262285,0.0155416277318285,0.0142066541712504,0.0128701306810565,0.0115394953100107,0.0102220017752608,0.00892466755886528,0.00765422467891608,0.00641707353961575,0.00521924023107068,0.00406633761264831,0.00296353047392486,0.00191550502496741,0.000926442923411805,1.11525091376610e-18,-0.000860710202584408,-0.00165312801009286,-0.00237525429619009,-0.00302565228783724,-0.00360344456935039,-0.00410830540246133,-0.00454044852240617,-0.00490061061049201,-0.00519003068135335,-0.00541042565785376,-0.00556396243799917,-0.00565322678603127,-0.00568118940383001,-0.00565116955868737,-0.00556679665927958,-0.00543197018316895,-0.00525081836636615,-0.00502765606838063,-0.00476694222483189,-0.00447323729418294,-0.00415116109562817,-0.00380535142180244,-0.00344042379299497,-0.00306093269920638,-0.00267133465296501,-0.00227595334963682,-0.00187894720335777,-0.00148427949604933,-0.00109569134461979,-0.000716677657790323,-0.000350466219407064,-8.52450501358639e-19,0.000332077236883820,0.000643432002029988,0.000932048824412150,0.00119623470776780,0.00143462036819149,0.00164615835150292,0.00183011815769880,0.00198607852618044,0.00211391705943763,0.00221379738426638,0.00228615406824375,0.00233167552495189,0.00235128515424334,0.00234612097361916,0.00231751400352989,0.00226696567312352,0.00219612451370543,0.00210676240502364,0.00200075063456296,0.00188003602246388,0.00174661735464425,0.00160252235438350,0.00144978540824230,0.00129042624596151,0.00112642975615688,0.000959727100451988,0.000792178268432394,0.000625556194723728,0.000461532537861143,0.000301665198690712,0.000147387634083492,5.37177083728209e-19,-0.000139337863343584,-0.000269611612060710,-0.000389955772496302,-0.000499655354637275,-0.000598145768592739,-0.000685011123663319,-0.000759981003936869,-0.000822925827117309,-0.000873850904330451,-0.000912889327894821,-0.000940293821459319,-0.000956427692479417,-0.000961755030737496,-0.000956830298541192,-0.000942287458406476,-0.000918828782519326,-0.000887213485158078,-0.000848246314650926,-0.000802766235456336,-0.000751635323717093,-0.000695727991290332,-0.000635920643942718,-0.000573081869274513,-0.000508063239154665,-0.000441690800169006,-0.000374757313962308,-0.000308015297547260,-0.000242170901809923,-0.000177878654706590,-0.000115737084158355,-5.62852245353016e-05,-2.72230054807109e-19,5.27055320431335e-05,0.000101483103475706,0.000146049358607650,0.000186185220281444,0.000221734548097256,0.000252602143789614,0.000278751163690595,0.000300200002137491,0.000317018712623681,0.000329325035461345,0.000337280101746987,0.000341083883529787,0.000340970459322546,0.000337203162518870,0.000330069677949087,0.000319877148789184,0.000306947352404964,0.000291611999545419,0.000274208206675691,0.000255074186243570,0.000234545194387696,0.000212949770103344,0.000190606294264461,0.000167819891237305,0.000144879690187308,0.000122056457647812,9.96006075534227e-05,7.77405898025864e-05,5.66816535579416e-05,3.66049769670717e-05,1.76671508312944e-05,1.05993133452081e-19,-1.62892770505984e-05,-3.11176728631918e-05,-4.44256646829561e-05,-5.61762639281772e-05,-6.63538496653903e-05,-7.49628153146993e-05,-8.20260583722624e-05,-8.75833430699886e-05,-9.16895656205954e-05,-9.44129510469669e-05,-9.58332095993489e-05,-9.60396794565135e-05,-9.51294808241022e-05,-9.32057047231078e-05,-9.03756577431642e-05,-8.67491818587006e-05,-8.24370661107082e-05,-7.75495645818067e-05,-7.21950326752301e-05,-6.64786912854027e-05,-6.05015260529610e-05,-5.43593265620017e-05,-4.81418680908409e-05,-4.19322363954913e-05,-3.58062940100488e-05,-2.98322847095129e-05,-2.40705711141284e-05,-1.85734989325399e-05,-1.33853800528926e-05,-8.54258560212579e-06,-4.07373920647937e-06,-2.89719267377562e-20,3.66457556098216e-06,6.91260431704773e-06,9.74289081321988e-06,1.21598967926915e-05,1.41731768585356e-05,1.57967910239781e-05,1.70487043808010e-05,1.79501835109037e-05,1.85251985648479e-05,1.87998391505708e-05,1.88017513326073e-05,1.85596021541489e-05,1.81025771776432e-05,1.74599156102765e-05,1.66604866535602e-05,1.57324098052809e-05,1.47027209599881e-05,1.35970853123658e-05,1.24395572762396e-05,1.12523868991003e-05,1.00558715848695e-05,8.86825134164361e-06,7.70564525030232e-06,6.58202640663524e-06,5.50923222512636e-06,4.49700670648745e-06,3.55307106198484e-06,2.68321895295421e-06,1.89143254004421e-06,1.18001553919068e-06,5.49739544871617e-07,4.45313678728079e-21,-4.71021640426103e-07,-8.66192794710010e-07,-1.18926468609567e-06,-1.44471004371163e-06,-1.63756599997700e-06,-1.77328430070119e-06,-1.85759062458968e-06,-1.89635448684709e-06,-1.89547088270588e-06,-1.86075451617924e-06,-1.79784716176526e-06,-1.71213842626197e-06,-1.60869991772379e-06,-1.49223259171050e-06,-1.36702683353428e-06,-1.23693465076478e-06,-1.10535319377551e-06,-9.75218694001071e-07,-8.49009809686771e-07,-7.28759296617454e-07,-6.16072875535055e-07,-5.12154147228806e-07,-4.17834408805857e-07,-3.33606248345541e-07,-2.59659837711268e-07,-7.60387794584338e-07]);
		
		textCoeficients.value = coeficients;
		getCoeficients();		
		
		$("#load_file").click(
			function(){
				var files = document.getElementById('audio_file').files;
				if (!files.length) {
				  alert('Selecione um arquivo de áudio primeiro');
				  return;
				}						
				modal.style.display = "block";
				var file = files[0];
				var reader = new FileReader();
				reader.readAsArrayBuffer(file);
				reader.onloadend = function(event) {
					loaded=true;
					$("#play").removeAttr("disabled");
					$("#stop").removeAttr("disabled");
					modal.style.display = "none";
					decodingModal.style.display = "block";
					file_array=event.target.result;
					source = audioCtx.createBufferSource();
					audioCtx.decodeAudioData(file_array).then(function(buffer2) {	
						audioBuffer = buffer2;
						decodingModal.style.display = "none";				
					});
				}
			}
		);
		
		$("#play").click(
			function(){
				if (!loaded) {
					  alert('Selecione um arquivo de áudio e clique em carregar primeiro');
					  return;
				}
				else{
					$("#play").attr("disabled","disabled");
					source = audioCtx.createBufferSource();
					source.buffer=audioBuffer;
					if($("#power").prop("checked")){
						source.connect(scriptNode);	
						scriptNode.connect(analyser);
						analyser.connect(masterGain);
						masterGain.connect(audioCtx.destination);
					}
					else{
						source.connect(analyser);					
						analyser.connect(masterGain);
						masterGain.connect(audioCtx.destination);			
					}
					source.start();
				}
			}
		);			
		
		$("#stop").click(
			function(){
				source.stop();
				$("#play").removeAttr("disabled");
			}
		);
		$("#oscilloscope").click(function(){
			if(visual_type=='t'){visual_type='f';}
			else{visual_type='t';}			
		});
		
		function getMaxOfArray(numArray) {
			return Math.max.apply(null, numArray);
		}	
		function getMinOfArray(numArray) {
			return Math.min.apply(null, numArray);
		}	
		
		function getCoeficients(){
			var rawCoeficients=textCoeficients.value.split(",");
			var dataCoeficients = rawCoeficients;
			var coeficientsLength = rawCoeficients.length;
			for(var i=0;i<coeficientsLength;i++){
				dataCoeficients[i]=parseFloat(rawCoeficients[i]);			
			}
			var impulseMax=getMaxOfArray(dataCoeficients);
			var impulseMin=getMinOfArray(dataCoeficients);
			var impulseYMax=Math.max(impulseMax,Math.abs(impulseMin));
			coeficients=dataCoeficients;	
			canvasCtxImpulse.fillStyle = '#424242';
			canvasCtxImpulse.fillRect(0, 0, canvasImpulse.width, canvasImpulse.height);
			canvasCtxImpulse.lineWidth = 1;
			canvasCtxImpulse.strokeStyle = '#aaa';
			canvasCtxImpulse.beginPath();
			var sliceWidth = canvasImpulse.width * 1.0 / coeficientsLength;
			
			var x = 0;
			for (var i = 0; i < coeficientsLength; i++) {
				var y = canvasImpulse.height - Math.abs(dataCoeficients[i]/impulseYMax+1)*canvasImpulse.height/2.1;
				if (i === 0) {
					canvasCtxImpulse.moveTo(x, y);
				} else {
					canvasCtxImpulse.lineTo(x, y);
				}
				x += sliceWidth;
			}
			canvasCtxImpulse.stroke();
		}
		
		$("#getCoeficients").click(function(){
			getCoeficients();			
		});
		
		function disconnectAll()
		{
			source.disconnect();
			scriptNode.disconnect();
			analyser.disconnect();
			masterGain.disconnect();
		}
		
		$("#vol-control").change(function(){
			masterGain.gain.value=$(this).val();
			$("#volume_text").text("Volume: "+parseInt($(this).val()*100)+"%");
		});
		
		$("#power").change(function(){
			if($(this).prop("checked")){
				disconnectAll();
				source.connect(scriptNode);	
				scriptNode.connect(analyser);
				analyser.connect(masterGain);
				masterGain.connect(audioCtx.destination);
			}
			else{
				disconnectAll();
				source.connect(analyser);					
				analyser.connect(masterGain);
				masterGain.connect(audioCtx.destination);				
			}
		});
		
		$("#menuPlayer").click(function(){
			$("#container1").show();
			$("#container2").hide();
			$("#menuPlayer").addClass("menuSelected");
			$("#menuFilter").removeClass("menuSelected");
		});
		$("#menuFilter").click(function(){
			$("#container1").hide();
			$("#container2").show();
			$("#menuPlayer").removeClass("menuSelected");
			$("#menuFilter").addClass("menuSelected");
		});
	});
</script>
</head>
<body>
	<header><div id="logo">two.DSP</div><div id="menu"><a class="menuElement menuSelected" id="menuPlayer">Player</a><a class="menuElement" id="menuFilter">Filtro</a></div></header>
	<br style="clear: both"/>
	<div id="container0">
	<div id="container1">
	<div id="myModal" class="modal">
		<div class="modal-content">
			<center>
				<p style="color: #232323;">Carregando o arquivo</p>
			</center>
	  </div>
	</div>
	<div id="decodingModal" class="modal">
		<center>
			<div class="modal-content">
				<p style="color: #232323;">Decodificando o arquivo</p>
			</div>
		</center>
	</div>
	<div class="divider">
		<input class="input_button" id="audio_file" type="file" accept="audio/*"/>
		<button id="load_file">Carregar áudio</button>
	</div>
	
	<br style="clear: both"/>
	<div class="divider">
		<button class="play_button" id="play" disabled="disabled">PLAY</button>
		<button class="stop_button" id="stop" disabled="disabled">STOP</button>
	</div>
	<br style="clear:both"/>
	<div class="divider">	
		<label class="switch" for="power">			
			<input type="checkbox" id="power">			
		  <div class="slider"></div>		  
		</label>
		<input id="vol-control" type="range" value="0.3" min="0" max="1" step="0.05"></input><br/>
		<div style="display:table">
			<div style="display:inline-block"><p class="label_text">Filtragem</p></div>
			<div style="display:inline-block; margin-left: 2.5em;"><p id="volume_text" class="label_text">Volume: 30%</p></div>
		</div>
	</div>
	<br style="clear: both"/>	
	<canvas id="oscilloscope"></canvas>	
	</div>
		<div id="container2">
			<p>Coeficientes separados por vírgula :</p>
			<textarea id="textCoeficients" rows="20" cols="115" ></textarea>
			<br style="clear: both"/>	
			<canvas id="graphImpulse"></canvas>
			<br/>	
			<button id="getCoeficients">Salvar filtro</button>
		</div>
	</div>
	<br style="clear:both"/>
	<footer>
	  <p>Guilherme Tworkowski | <a href="mailto:guitw2@gmail.com">guitw2@gmail.com</a></p>
	</footer> 
</body>
</html>
